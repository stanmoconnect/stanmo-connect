<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sign Up ‚Äî Stanmo Connect</title>
  <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --orange: #F47B20;
      --dark: #0d1117;
      --card: #161b22;
      --border: #30363d;
      --text: #e6edf3;
      --muted: #8b949e;
    }

    body {
      background: var(--dark);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 2rem 1rem;
    }

    .logo {
      font-family: 'Syne', sans-serif;
      font-weight: 800;
      font-size: 1.5rem;
      color: var(--orange);
      text-decoration: none;
      margin-bottom: 2rem;
      display: block;
      text-align: center;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 2.5rem 2rem;
      width: 100%;
      max-width: 480px;
    }

    h1 {
      font-family: 'Syne', sans-serif;
      font-size: 1.6rem;
      font-weight: 700;
      margin-bottom: 0.5rem;
    }

    .subtitle {
      color: var(--muted);
      font-size: 0.9rem;
      margin-bottom: 2rem;
    }

    /* Role selector */
    .role-tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 0.75rem;
      margin-bottom: 1.75rem;
    }

    .role-tab {
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      cursor: pointer;
      text-align: center;
      transition: all 0.2s;
      background: transparent;
      color: var(--muted);
    }

    .role-tab.active {
      border-color: var(--orange);
      background: rgba(244,123,32,0.08);
      color: var(--text);
    }

    .role-tab .icon { font-size: 1.5rem; display: block; margin-bottom: 0.3rem; }
    .role-tab .label { font-size: 0.85rem; font-weight: 500; }

    .form-group { margin-bottom: 1.25rem; }

    label {
      display: block;
      font-size: 0.85rem;
      font-weight: 500;
      margin-bottom: 0.4rem;
      color: var(--text);
    }

    input, select {
      width: 100%;
      background: var(--dark);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      padding: 0.75rem 1rem;
      font-size: 0.95rem;
      font-family: 'DM Sans', sans-serif;
      outline: none;
      transition: border-color 0.2s;
    }

    input:focus, select:focus { border-color: var(--orange); }
    select option { background: var(--dark); }

    /* Provider extra fields */
    .provider-fields { display: none; }
    .provider-fields.show { display: block; }

    .btn {
      width: 100%;
      background: var(--orange);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 0.9rem;
      font-size: 1rem;
      font-weight: 600;
      font-family: 'Syne', sans-serif;
      cursor: pointer;
      margin-top: 0.5rem;
      transition: opacity 0.2s;
    }

    .btn:hover { opacity: 0.9; }
    .btn:disabled { opacity: 0.5; cursor: not-allowed; }

    .login-link {
      text-align: center;
      margin-top: 1.5rem;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .login-link a { color: var(--orange); text-decoration: none; }

    .error-msg {
      background: rgba(255,80,80,0.1);
      border: 1px solid rgba(255,80,80,0.3);
      color: #ff6b6b;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 0.85rem;
      margin-bottom: 1rem;
      display: none;
    }

    .success-msg {
      background: rgba(40,200,100,0.1);
      border: 1px solid rgba(40,200,100,0.3);
      color: #5dbb84;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      font-size: 0.85rem;
      margin-bottom: 1rem;
      display: none;
    }

    .note {
      font-size: 0.8rem;
      color: var(--muted);
      margin-top: 0.4rem;
    }

    .price-badge {
      display: inline-block;
      background: rgba(244,123,32,0.15);
      color: var(--orange);
      border-radius: 6px;
      padding: 0.2rem 0.6rem;
      font-size: 0.8rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }
  </style>
</head>
<body>

  <a class="logo" href="index.html">SC STANMO CONNECT</a>

  <div class="card">
    <h1>Create Account</h1>
    <p class="subtitle">Join Port Harcourt's most trusted service network.</p>

    <div class="role-tabs">
      <div class="role-tab active" id="tab-requester" onclick="setRole('requester')">
        <span class="icon">üîç</span>
        <span class="label">I Need a Service</span>
      </div>
      <div class="role-tab" id="tab-provider" onclick="setRole('provider')">
        <span class="icon">üîß</span>
        <span class="label">I'm a Provider <span class="price-badge">‚Ç¶3,000/mo</span></span>
      </div>
    </div>

    <div class="error-msg" id="error-msg"></div>
    <div class="success-msg" id="success-msg"></div>

    <form id="signup-form">
      <div class="form-group">
        <label>Full Name</label>
        <input type="text" id="fullname" placeholder="Your full name" required />
      </div>

      <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="email" placeholder="you@example.com" required />
      </div>

      <div class="form-group">
        <label>Phone / WhatsApp</label>
        <input type="tel" id="phone" placeholder="08012345678" required />
      </div>

      <div class="form-group">
        <label>Location in Port Harcourt</label>
        <select id="location">
          <option value="">Select your area</option>
          <option>GRA</option>
          <option>Trans-Amadi</option>
          <option>Rumuola</option>
          <option>D-Line</option>
          <option>Woji</option>
          <option>Rumuibekwe</option>
          <option>Eliozu</option>
          <option>Mgbuoba</option>
          <option>Peter Odili</option>
          <option>Rumuokoro</option>
          <option>UNIPORT Area</option>
          <option>Other</option>
        </select>
      </div>

      <!-- Provider-only fields -->
      <div class="provider-fields" id="provider-fields">
        <div class="form-group">
          <label>Business Name</label>
          <input type="text" id="businessname" placeholder="Your business name" />
        </div>
        <div class="form-group">
          <label>Service Category</label>
          <select id="category">
            <option value="">Select category</option>
            <option>Home & Repair</option>
            <option>Plumbing</option>
            <option>Electrical</option>
            <option>Automotive / Mechanic</option>
            <option>Cleaning & Maintenance</option>
            <option>Beauty & Fashion</option>
            <option>Technical Services</option>
            <option>Food & Events</option>
            <option>Logistics & Transport</option>
            <option>Property & Real Estate</option>
            <option>Professional Services</option>
          </select>
        </div>
        <div class="form-group">
          <label>Service Description</label>
          <input type="text" id="servicedesc" placeholder="Briefly describe what you do" />
        </div>
        <div class="form-group">
          <label>Price Range (‚Ç¶)</label>
          <input type="text" id="pricerange" placeholder="e.g. 5,000 - 50,000" />
          <p class="note">‚ö†Ô∏è Monthly subscription: ‚Ç¶3,000. You'll be redirected to pay after signup.</p>
        </div>
      </div>

      <div class="form-group">
        <label>Password</label>
        <input type="password" id="password" placeholder="Minimum 6 characters" required />
      </div>

      <button class="btn" type="submit" id="submit-btn">Create Account ‚Üí</button>
    </form>

    <div class="login-link">
      Already have an account? <a href="login.html">Sign in</a>
    </div>
  </div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyCckKrwsUd9oyHh_w5E06S5fVYCgEDhHeA",
    authDomain: "stanmo-connect.firebaseapp.com",
    projectId: "stanmo-connect",
    storageBucket: "stanmo-connect.firebasestorage.app",
    messagingSenderId: "1030645380559",
    appId: "1:1030645380559:web:8b1385e0b6f2d90badceba"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  let currentRole = 'requester';

  window.setRole = function(role) {
    currentRole = role;
    document.getElementById('tab-requester').classList.toggle('active', role === 'requester');
    document.getElementById('tab-provider').classList.toggle('active', role === 'provider');
    document.getElementById('provider-fields').classList.toggle('show', role === 'provider');
  };

  document.getElementById('signup-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const btn = document.getElementById('submit-btn');
    const errorMsg = document.getElementById('error-msg');
    const successMsg = document.getElementById('success-msg');
    errorMsg.style.display = 'none';
    successMsg.style.display = 'none';

    const fullname = document.getElementById('fullname').value.trim();
    const email = document.getElementById('email').value.trim();
    const phone = document.getElementById('phone').value.trim();
    const location = document.getElementById('location').value;
    const password = document.getElementById('password').value;

    if (!location) {
      errorMsg.textContent = 'Please select your location.';
      errorMsg.style.display = 'block';
      return;
    }

    btn.disabled = true;
    btn.textContent = 'Creating account...';

    try {
      const userCred = await createUserWithEmailAndPassword(auth, email, password);
      const uid = userCred.user.uid;

      const userData = {
        uid,
        fullname,
        email,
        phone,
        location,
        role: currentRole,
        createdAt: serverTimestamp(),
        subscriptionActive: currentRole === 'requester' ? true : false,
        subscriptionExpiry: null
      };

      if (currentRole === 'provider') {
        userData.businessname = document.getElementById('businessname').value.trim();
        userData.category = document.getElementById('category').value;
        userData.servicedesc = document.getElementById('servicedesc').value.trim();
        userData.pricerange = document.getElementById('pricerange').value.trim();
        userData.rating = 0;
        userData.reviewCount = 0;
        userData.verified = false;
        userData.profileVisible = false; // hidden until payment
      }

      await setDoc(doc(db, 'users', uid), userData);

      successMsg.textContent = currentRole === 'provider'
        ? '‚úÖ Account created! Redirecting to payment...'
        : '‚úÖ Account created! Redirecting to your dashboard...';
      successMsg.style.display = 'block';

      setTimeout(() => {
        if (currentRole === 'provider') {
          window.location.href = 'payment.html';
        } else {
          window.location.href = 'dashboard-requester.html';
        }
      }, 1500);

    } catch (err) {
      let msg = 'Something went wrong. Please try again.';
      if (err.code === 'auth/email-already-in-use') msg = 'This email is already registered. Please log in.';
      if (err.code === 'auth/weak-password') msg = 'Password must be at least 6 characters.';
      if (err.code === 'auth/invalid-email') msg = 'Please enter a valid email address.';
      errorMsg.textContent = msg;
      errorMsg.style.display = 'block';
      btn.disabled = false;
      btn.textContent = 'Create Account ‚Üí';
    }
  });
</script>
</body>
</html>
